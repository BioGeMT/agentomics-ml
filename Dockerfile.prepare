FROM continuumio/miniconda3:23.3.1-0

# We don't actually need git for dataset preparation, skip system packages

# Create preparation environment
COPY environment.yaml .
RUN conda env create -f environment.yaml \
    && conda clean -afy

# Initialize conda
RUN conda init bash

# Set working directory
WORKDIR /repository

# Set the default command to run preparation directly
CMD ["conda", "run", "-n", "agentomics-env", "python", "/repository/src/utils/dataset_preparation.py", "--batch"] 